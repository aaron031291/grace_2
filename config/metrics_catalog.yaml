# GRACE Metrics Catalog
# Production-ready metric definitions for autonomous monitoring

metrics:
  # API & Gateway Health
  - metric_id: api.latency_p95
    category: api
    description: "95th percentile FastAPI response latency"
    unit: ms
    aggregation: p95
    thresholds:
      good: { upper: 350 }
      warning: { lower: 350, upper: 500 }
      critical: { lower: 500 }
    playbooks:
      - scale-api-shard
      - failover-gateway
    recommended_interval_seconds: 60
    source: internal
    resource_scope: service
    tags: [production, api, latency]

  - metric_id: api.error_rate
    category: api
    description: "5xx error rate (errors / total requests)"
    unit: ratio
    aggregation: avg
    thresholds:
      good: { upper: 0.01 }
      warning: { lower: 0.01, upper: 0.03 }
      critical: { lower: 0.03 }
    playbooks:
      - restart-workers
      - engage-remediation
    recommended_interval_seconds: 60
    source: internal
    resource_scope: service
    tags: [production, api, errors]

  - metric_id: api.request_rate
    category: api
    description: "Requests per second"
    unit: req_per_sec
    aggregation: avg
    thresholds:
      good: { upper: 200 }
      warning: { lower: 200, upper: 400 }
      critical: { lower: 400 }
    playbooks:
      - pre-scale
      - activate-autoscaling
    recommended_interval_seconds: 60
    source: internal
    resource_scope: service
    tags: [production, api, throughput]

  # Executor & Queue Health
  - metric_id: executor.queue_depth
    category: executor
    description: "Pending tasks in execution queue"
    unit: count
    aggregation: max
    thresholds:
      good: { upper: 25 }
      warning: { lower: 25, upper: 75 }
      critical: { lower: 75 }
    playbooks:
      - scale-workers
      - spawn-emergency-shard
    recommended_interval_seconds: 30
    source: internal
    resource_scope: queue
    tags: [execution, queue]

  - metric_id: executor.task_latency
    category: executor
    description: "Age of oldest queued task"
    unit: seconds
    aggregation: max
    thresholds:
      good: { upper: 60 }
      warning: { lower: 60, upper: 180 }
      critical: { lower: 180 }
    playbooks:
      - increase-workers
      - escalate-to-human
    recommended_interval_seconds: 30
    source: internal
    resource_scope: queue
    tags: [execution, latency]

  # Learning Pipeline
  - metric_id: learning.sources_verified
    category: learning
    description: "Percentage of sources passing governance checks"
    unit: percent
    aggregation: avg
    thresholds:
      good: { lower: 85 }
      warning: { lower: 70, upper: 85 }
      critical: { upper: 70 }
    playbooks:
      - run-trust-analysis
      - stop-ingestion-cycle
    recommended_interval_seconds: 300
    source: internal
    resource_scope: subsystem
    tags: [learning, governance]

  - metric_id: learning.governance_blocks
    category: learning
    description: "Count of ingestion attempts blocked by governance"
    unit: count
    aggregation: sum
    thresholds:
      good: { upper: 2 }
      warning: { lower: 2, upper: 5 }
      critical: { lower: 5 }
    playbooks:
      - audit-governance-rules
      - require-human-review
    recommended_interval_seconds: 300
    source: internal
    resource_scope: subsystem
    tags: [learning, governance]

  # Autonomy & Decision Quality
  - metric_id: autonomy.plan_success_rate
    category: autonomy
    description: "Percentage of recovery plans completing successfully"
    unit: percent
    aggregation: avg
    thresholds:
      good: { lower: 90 }
      warning: { lower: 75, upper: 90 }
      critical: { upper: 75 }
    playbooks:
      - tighten-guardrails
      - downgrade-autonomy-tier
    recommended_interval_seconds: 300
    source: internal
    resource_scope: subsystem
    tags: [autonomy, quality]

  - metric_id: autonomy.approvals_pending
    category: autonomy
    description: "High-risk actions awaiting approval"
    unit: count
    aggregation: max
    thresholds:
      good: { upper: 3 }
      warning: { lower: 3, upper: 7 }
      critical: { lower: 7 }
    playbooks:
      - notify-reviewers
      - pause-high-risk-plans
    recommended_interval_seconds: 60
    source: internal
    resource_scope: subsystem
    tags: [autonomy, governance]

  # Infrastructure Health
  - metric_id: infra.cpu_utilization
    category: infra
    description: "CPU usage percentage"
    unit: percent
    aggregation: avg
    thresholds:
      good: { upper: 70 }
      warning: { lower: 70, upper: 85 }
      critical: { lower: 85 }
    playbooks:
      - shift-load
      - scale-nodes
    recommended_interval_seconds: 30
    source: system
    resource_scope: host
    tags: [infrastructure, cpu]

  - metric_id: infra.memory_utilization
    category: infra
    description: "Memory usage percentage"
    unit: percent
    aggregation: avg
    thresholds:
      good: { upper: 75 }
      warning: { lower: 75, upper: 90 }
      critical: { lower: 90 }
    playbooks:
      - restart-non-critical
      - migrate-workloads
    recommended_interval_seconds: 30
    source: system
    resource_scope: host
    tags: [infrastructure, memory]

  - metric_id: infra.disk_usage
    category: infra
    description: "Disk utilization percentage"
    unit: percent
    aggregation: max
    thresholds:
      good: { upper: 70 }
      warning: { lower: 70, upper: 85 }
      critical: { lower: 85 }
    playbooks:
      - cleanup-tasks
      - trigger-disk-expansion
    recommended_interval_seconds: 300
    source: system
    resource_scope: volume
    tags: [infrastructure, disk]

  # Trigger Mesh Health
  - metric_id: trigger.mesh_queue_depth
    category: trigger
    description: "Events awaiting routing in trigger mesh"
    unit: count
    aggregation: max
    thresholds:
      good: { upper: 50 }
      warning: { lower: 50, upper: 150 }
      critical: { lower: 150 }
    playbooks:
      - scale-router
      - shed-non-critical-events
    recommended_interval_seconds: 30
    source: internal
    resource_scope: subsystem
    tags: [trigger_mesh, queue]
