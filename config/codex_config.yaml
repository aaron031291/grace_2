# Codex system configuration
# This file can be customized in deployments to describe additional loops, hooks, and analysis knobs.

loops:
  - name: memory_core
    module: backend.memory
    entrypoint: MemoryCore
    description: Guards the memory ingestion + writeback recursion.
    expected_feedback: true
    telemetry_keys:
      - last_heartbeat
      - drift_score
      - write_latency_ms
  - name: trust_framework
    module: backend.trust_framework
    entrypoint: TrustFramework
    description: Maintains trust/confidence convergence before governance acts.
    expected_feedback: true
    telemetry_keys:
      - trust_score
      - confidence_score
  - name: governance_core
    module: backend.governance
    entrypoint: GovernanceCore
    description: Approval + policy validation loop.
    expected_feedback: true
    telemetry_keys:
      - pending_approvals
      - policy_violations
  - name: mldl_intelligence
    module: backend.learning
    entrypoint: LearningIntelligenceLoop
    description: Routes MLDL outcomes to memory / governance.
    expected_feedback: true
    telemetry_keys:
      - queued_jobs
      - success_rate
  - name: mission_orchestrator
    module: backend.orchestration
    entrypoint: MissionOrchestrator
    description: Mission planning and action dispatch loop.
    expected_feedback: true
    telemetry_keys:
      - active_missions
      - loop_iterations

hook_expectations:
  agent_action:
    expected_publishers:
      - backend.autonomy.autonomous_executor.AutonomousExecutor
      - backend.missions.mission_control.MissionControl
    expected_subscribers:
      - backend.guardian.guardian_agent.GuardianAgent
      - backend.self_heal.self_heal_coordinator.SelfHealCoordinator
    payload_contract:
      required_keys:
        - action
        - actor
        - metadata
  memory_update:
    expected_publishers:
      - backend.memory.memory_services.MemoryWriteService
      - backend.learning.ingestion.MemoryIngestionAgent
    expected_subscribers:
      - backend.world_model.world_model_controller.WorldModelController
      - backend.metrics_service.MemoryMetricsAdapter
    payload_contract:
      required_keys:
        - memory_id
        - source
        - confidence

analysis:
  default_runtime_depth: 128
  emit_reports: true
  offline_mode: true

identity_tracking:
  canonical_signature: component::subsystem::agent
  event_source: codex_init_module
  fallback_component: codex
  allowed_components:
    - memory_core
    - guardian
    - governance
    - mldl
    - mission_orchestrator
    - codex

intelligence_links:
  - name: mldl_to_memory
    source: mldl_intelligence
    target: memory_core
    description: Ensures MLDL insights become memory entries.
    required_fields:
      - last_insight
      - memory_updates
  - name: memory_to_governance
    source: memory_core
    target: governance_core
    description: Validates policy reviews incorporate memory updates.
    required_fields:
      - policy_inputs
      - approval_required
  - name: governance_to_action
    source: governance_core
    target: mission_orchestrator
    description: Confirms missions honor governance approvals.
    required_fields:
      - approval_status
      - action_contract

evolution_targets:
  - path: backend/codex/codex_init_module.py
    max_lines: 600
    placeholder_markers:
      - TODO
      - FIXME
      - pass
      - NotImplemented
  - path: backend/event_bus.py
    max_lines: 400
    placeholder_markers:
      - TODO
      - FIXME
