# Autonomous Improver Whitelist Configuration
# Files/patterns that are safe to improve despite TODO/secret markers

# Files that are intentionally stub/placeholder (safe to skip)
skip_files:
  # Marketplace integrations (awaiting credentials)
  - backend/transcendence/business/marketplace_connector.py
  - backend/transcendence/business/payment_processor.py
  
  # External API integrations (credential-dependent)
  - backend/post_boot_orchestrator.py
  - backend/multimodal_llm.py
  
  # Security-sensitive files (manual review only)
  - backend/secrets_vault.py
  - backend/auth.py
  - backend/routes/websocket_routes.py

# Files where TODOs are design decisions (not errors)
design_decision_todos:
  - backend/memory_learning_pipeline.py  # TODO(ROADMAP): fine-tuning strategy
  - backend/parliament_engine.py          # TODO(ROADMAP): notification channels
  - backend/code_generator.py             # TODO: intentional placeholders
  - backend/commit_workflow.py            # TODO(ROADMAP): linter/test detection, GitHub API
  - backend/constitutional_engine.py      # TODO(ROADMAP): Parliament escalation
  - backend/grace_spine_integration.py    # TODO(ROADMAP): register other domains
  - backend/input_sentinel.py             # TODO(ROADMAP): policy engine integration
  - backend/metrics_collector.py          # TODO(ROADMAP): Prometheus client
  - backend/secrets_vault.py              # TODO(ROADMAP): governance approval
  - backend/transcendence/**/*.py         # TODO(ROADMAP): integration stubs
  - backend/cognition/**/*.py             # TODO(FUTURE): implementation pending

# Patterns that are safe (not actual secrets)
safe_patterns:
  - "import secrets"                      # Python secrets module
  - "secrets.token_"                      # Secure random generation
  - "_TokenBucket"                        # Rate limiting class
  - "token: str"                          # Type hint
  - "api_key: str"                        # Type hint/parameter
  - "password_hash"                       # Hashed, not plaintext
  - "[REDACTED:"                          # Already redacted
  - "# Get user from token"               # Comment
  - "max_tokens="                         # LLM parameter

# Files where secret patterns are expected and safe
expected_secret_patterns:
  backend/secrets_vault.py:
    - "secret_key"                        # Column name
    - "secret_type"                       # Column name
    - "SecretEntry"                       # Class name
    - "SecretAccessLog"                   # Class name
  
  backend/logging_utils.py:
    - "REDACT_KEYS"                       # Redaction list
    - "password"                          # In redaction list
    - "token"                             # In redaction list
  
  backend/seed_constitution.py:
    - "scan_for_secrets"                  # Tenet name
    - "API_KEY="                          # Example in docs
  
  backend/ide_websocket_handler.py:
    - "password ="                        # Security check pattern
  
  backend/tests/:
    - "*"                                 # Test files can have test secrets

# TODO patterns that are intentional placeholders (safe)
safe_todo_patterns:
  - "# TODO: Implement function logic"    # Code generator output
  - "# TODO: Add assertions"              # Test generator output
  - "pass  # TODO:"                       # Stub functions
  - "TODO(SAFE)"                          # Explicitly marked as safe
  - "TODO(ROADMAP)"                       # Future enhancement, intentional
  - "TODO(DESIGN)"                        # Design decision, not a bug
  - "TODO(FUTURE)"                        # Future feature, deferred

# Autonomous improvement allowed on these despite TODOs
allow_improvement:
  # Agent timeline has TODOs but is functional
  - backend/routes/agent_timeline.py
  
  # Code healing can be improved
  - backend/routes/code_healing_api.py
  
  # Commit workflow TODOs are enhancement notes
  - backend/commit_workflow.py
  
  # Learning routes are functional despite TODOs
  - backend/routes/learning_routes.py
  
  # Self-healing and autonomous systems (Grace can improve herself)
  - backend/autonomous_improver.py
  - backend/autonomous_code_healer.py
  - backend/self_heal/**/*.py
  - backend/meta_loop.py
  - backend/proactive_intelligence.py
  - backend/real_proactive_intelligence.py
  
  # Metrics and monitoring (safe infrastructure)
  - backend/metrics_collector.py
  - backend/metrics_snapshot_aggregator.py
  - backend/telemetry_schemas.py
  
  # Boot and orchestration (TODO notes are roadmap items)
  - backend/boot_pipeline.py
  - backend/enhanced_boot_pipeline.py
  - backend/post_boot_orchestrator.py
  
  # Routes and APIs (functional despite enhancement TODOs)
  - backend/routes/**/*.py
  
  # Agentic tools and workflows
  - backend/agentic/**/*.py
  - backend/code_generator.py

# Governance rules
rules:
  # Block on these always (never auto-improve)
  always_block:
    - "hardcoded password ="              # Actual hardcoded secret
    - "api_key = '[A-Z0-9]{32,}'"        # Actual API key pattern
    - "SECRET_KEY = 'prod"                # Production secret
  
  # Review required but can proceed with approval
  review_required:
    - Files in transcendence/business/    # Business logic
    - Files modifying secrets_vault       # Security critical
    - Files with >10 TODOs                # Needs design review
  
  # Auto-improvement allowed
  auto_allowed:
    - Documentation files (*.md)
    - Test files (tests/*)
    - Generated code stubs
    - Files in whitelist

# Notification settings
notifications:
  # Notify on these even if whitelisted
  always_notify:
    - Changes to authentication
    - Changes to secrets_vault
    - Changes to governance policies
  
  # Silent improvements (no notification)
  silent_ok:
    - Code formatting
    - Import organization
    - Type hint additions
    - Docstring improvements
